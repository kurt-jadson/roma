CREATE TABLE DG_METANALISE (
	ID BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	TITULO VARCHAR(255) NOT NULL,
	PESQUISADORINCLUSAO_ID BIGINT NOT NULL,
	DATAINCLUSAO DATETIME NOT NULL
);

ALTER TABLE DG_METANALISE
ADD CONSTRAINT DG_METANALISE_REFERENCES_SYS_PESQUISADOR_0001
FOREIGN KEY (PESQUISADORINCLUSAO_ID) REFERENCES SYS_PESQUISADOR (ID);

CREATE TABLE DG_METANALISE_ETAPA (
	ID BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(255) NOT NULL
);

CREATE TABLE DG_METANALISE_METANALISE_ETAPA (
	METANALISE_ID BIGINT NOT NULL,
	METANALISEETAPA_ID BIGINT NOT NULL,
	CONCLUIDA BIT DEFAULT 0
);

ALTER TABLE DG_METANALISE_METANALISE_ETAPA
ADD CONSTRAINT DG_METANALISE_METANALISE_ETAPA_REFERENCES_DG_METANALISE_0001
FOREIGN KEY (METANALISE_ID) REFERENCES DG_METANALISE (ID);

ALTER TABLE DG_METANALISE_METANALISE_ETAPA
ADD CONSTRAINT DG_MAN_MAN_ETAPA_REFERENCES_DG_MAN_ETAPA_0001
FOREIGN KEY (METANALISEETAPA_ID) REFERENCES DG_METANALISE_ETAPA (ID);

CREATE TABLE DG_METANALISE_ROW (
	ID BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	NUMERO BIGINT NOT NULL,
	TITULO VARCHAR(255) NOT NULL,
	AUTOR VARCHAR(255) NULL,
	TP DECIMAL(12,4) NULL,
	TN DECIMAL(12,4) NULL,
	FP DECIMAL(12,4) NULL,
	FN DECIMAL(12,4) NULL
);

-- Etapas padrões
INSERT INTO DG_METANALISE_ETAPA (ID, NOME)
	VALUES (1, 'br.com.smadp.bancoDados');
INSERT INTO DG_METANALISE_ETAPA (ID, NOME)
	VALUES (2, 'br.com.smadp.qualidadeEstudos');
INSERT INTO DG_METANALISE_ETAPA (ID, NOME)
	VALUES (3, 'br.com.smadp.analiseTabular');
INSERT INTO DG_METANALISE_ETAPA (ID, NOME)
	VALUES (4, 'br.com.smadp.analiseGrafica');
INSERT INTO DG_METANALISE_ETAPA (ID, NOME)
	VALUES (5, 'br.com.smadp.analiseViesPublicacao');

-- Metanálises de exemplo
INSERT INTO DG_METANALISE (ID, TITULO, PESQUISADORINCLUSAO_ID, DATAINCLUSAO)
	VALUES (1, 'Lorem ipsum dolor sit amet', 1, NOW());
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (1, 1, 0);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (1, 2, 0);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (1, 3, 0);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (1, 4, 0);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (1, 5, 0);

INSERT INTO DG_METANALISE (ID, TITULO, PESQUISADORINCLUSAO_ID, DATAINCLUSAO)
	VALUES (2, 'Duis molestie luctus risus', 1, NOW());
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (2, 1, 1);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (2, 2, 1);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (2, 3, 0);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (2, 4, 0);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (2, 5, 0);

INSERT INTO DG_METANALISE (ID, TITULO, PESQUISADORINCLUSAO_ID, DATAINCLUSAO)
	VALUES (3, 'Praesent dictum mauris eget', 1, NOW());
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (3, 1, 1);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (3, 2, 1);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (3, 3, 1);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (3, 4, 0);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (3, 5, 0);

INSERT INTO DG_METANALISE (ID, TITULO, PESQUISADORINCLUSAO_ID, DATAINCLUSAO)
	VALUES (4, 'Aenean ut hendrerit purus', 1, NOW());
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (4, 1, 1);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (4, 2, 1);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (4, 3, 1);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (4, 4, 1);
INSERT INTO DG_METANALISE_METANALISE_ETAPA (METANALISE_ID, METANALISEETAPA_ID, CONCLUIDA)
	VALUES (4, 5, 1);