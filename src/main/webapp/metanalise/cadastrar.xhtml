<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:s="http://www.lassitercg.com/jsf"
	  xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	  xmlns:f="http://xmlns.jcp.org/jsf/core">
    <ui:composition template="/WEB-INF/templates/layout.xhtml">
		<ui:define name="metadata">
			<f:metadata>
				<f:viewParam name="metanalise" 
							 value="#{metanaliseController.metanalise.id}" />
				<f:viewAction action="#{metanaliseController.loadMetanalise()}" 
							  if="#{not empty param['metanalise']}" />
			</f:metadata>
		</ui:define>

		<ui:define name="conteudo">
			<h:form id="metanaliseForm">
				<div class="mensagem-snippet">
					<h:messages id="messages" errorClass="alert alert-danger" />
				</div>
				<div class="page-header">
					<h1>#{i18n['metanalise.cadastro']}</h1>
				</div>

				<div class="container-fluid">
					<div class="row">
						<div class="col-md-12">
							<div class="form-group">
								<h:outputLabel for="titulo" value="#{i18n['metanalise.titulo']}" />					
								<h:inputText id="titulo"
											 value="#{metanaliseController.metanalise.titulo}"
											 required="true"
											 requiredMessage="#{i18n['smadp.mensagens.0001']}"
											 styleClass="form-control #{not component.valid ? 'error' : ''}" />
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-2">
							<div class="form-group metanalise-control">
								<div class="metanalise-control-linha">#{i18n['metanalise.linha']}</div>
								<div>
									<button class="btn btn-default btn-add" 
											onclick="$('#metanaliseForm\\:addRowBtn').trigger('click');
													return false;">
										<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
									</button>
									<h:commandButton id="addRowBtn" 
													 styleClass="hidden">
										<f:ajax render="metanaliseForm:sheet"
												listener="#{metanaliseController.adicionarLinha()}" />
									</h:commandButton>
								</div>	
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group metanalise-control">
								<div>
									<h:inputText id="nomeColuna" 
												 value="#{metanaliseController.nomeColuna}" 
												 styleClass="form-control #{not component.valid ? 'error' : ''}"
												 pt:placeholder="#{i18n['metanalise.nomeColuna']}"
												 required="#{facesContext.partialViewContext.ajaxRequest}"
												 requiredMessage="#{i18n['metanalise.nomeColuna.requiredMessage']}"
												 validator="#{metanaliseController.validarNomeColuna}" />
								</div>
								<div>
									<button class="btn btn-default btn-add"
											onclick="$('#metanaliseForm\\:addColBtn').trigger('click');
													return false;">
										<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
									</button>
									<h:commandButton id="addColBtn"
													 styleClass="hidden">
										<f:ajax execute="@this nomeColuna"
												render="metanaliseForm:sheet metanaliseForm:messages nomeColuna"
												listener="#{metanaliseController.adicionarColuna()}" />
									</h:commandButton>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="form-group col-md-12">
							<s:sheet id="sheet"
									 value="#{metanaliseController.estudos}"
									 var="row"
									 height="400"
									 showRowHeaders="false"
									 binding="#{metanaliseController.sheet}">

								<s:column headerText="#{i18n['metanalise.numero']}" 
										  colWidth="15"
										  colType="numeric"
										  value="#{row.numero}"
										  sortBy="#{row.numero}"
										  sortOrder="ascending"
										  readonly="true" />
								<s:column headerText="#{i18n['metanalise.titulo']}" 
										  colWidth="60"
										  colType="text"
										  sortBy="#{row.titulo}"
										  sortOrder="ascending"
										  value="#{row.titulo}"
										  required="true"
										  requiredMessage="#{i18n['metanalise.sheet.titulo.requiredMessage']}" />
								<s:column headerText="#{i18n['metanalise.autor']}" 
										  colWidth="60"
										  colType="text"
										  value="#{row.autor}"
										  sortBy="#{row.autor}"
										  sortOrder="ascending" />
								<s:column headerText="#{i18n['metanalise.tp']}" 
										  colWidth="15"
										  colType="numeric"
										  value="#{row.tp}"
										  sortBy="#{row.tp}"
										  sortOrder="ascending" />
								<s:column headerText="#{i18n['metanalise.tn']}" 
										  colWidth="15"
										  colType="numeric"
										  value="#{row.tn}"
										  sortBy="#{row.tn}"
										  sortOrder="ascending" />
								<s:column headerText="#{i18n['metanalise.fp']}" 
										  colWidth="15"
										  colType="numeric"
										  value="#{row.fp}"
										  sortBy="#{row.fp}"
										  sortOrder="ascending" />
								<s:column headerText="#{i18n['metanalise.fn']}" 
										  colWidth="15"
										  colType="numeric"
										  value="#{row.fn}"
										  sortBy="#{row.fn}"
										  sortOrder="ascending" />
							</s:sheet>
						</div>
					</div>
					<div class="row">
						<div class="col-md-1">
							<h:commandButton value="#{i18n['botao.salvar']}"
											 action="#{metanaliseController.salvar()}"
											 styleClass="btn btn-default"/>
						</div>
					</div>
				</div>
			</h:form>
		</ui:define>
	</ui:composition>
</html>